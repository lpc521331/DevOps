一：环境准备
1.禁用服务器防火墙（查看防火墙的状态：sudo systemctl status firewalld 关闭防火墙和开机禁用：systemctl stop firewalld && sudo systemctl disable firewalld）

2. 禁用 Swap（K8s 要求）
sudo swapoff -a  # 临时关闭
sudo sed -i '/swap/s/^/#/' /etc/fstab  # 永久关闭（注释 swap 行）
swapon --show 查看是否已经关闭，无输出已关闭
步骤 3：同步服务器时间
集群节点时间同步至关重要，否则会导致证书错误等问题。

bash
# 安装并启动 chrony 时间同步服务
sudo yum install -y chrony
sudo systemctl enable --now chronyd

# 检查时间同步状态
timedatectl status

步骤 4：设置主机名 (Hostname)
# 查看当前主机名
hostnamectl

# 设置新的主机名（例如：liupcMaster）
sudo hostnamectl set-hostname liupcMaster

5.配置k8s源
查看 sudo yum list | grep kubernetes
删除 sudo yum clean all
下载 sudo yum makecache

cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF


步骤 6：安装并配置 Docker
Kubernetes 使用容器运行时接口 (CRI) 与 Docker 交互。

# 1. 卸载旧版本 Docker（如果存在）
sudo yum remove -y docker docker-client docker-client-latest docker-common docker-latest docker-latest-logrotate docker-logrotate docker-engine

# 2. 安装依赖包并配置 Docker 阿里云镜像源
sudo yum install -y yum-utils
sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo

# 3. 安装 Docker
sudo yum install -y docker-ce docker-ce-cli containerd.io

# 5. 启动并设置 Docker 开机自启
sudo systemctl enable --now docker


 安装 K8s 组件
sudo yum install -y kubelet kubeadm kubectl --disableexcludes=kubernetes

 启动 kubelet 并设置开机自启
sudo systemctl enable --now kubelet

 初始化 K8s 单节点集群（允许控制平面调度 Pod，适合单服务器）
kubeadm init --kubernetes-version=v1.28.2 --image-repository registry.aliyuncs.com/google_containers --pod-network-cidr=10.244.0.0/16 --service-cidr=10.96.0.0/12 --cri-socket unix:///var/run/containerd/containerd.sock --ignore-preflight-errors=Swap

网络桥接配置：确保 /proc/sys/net/bridge/bridge-nf-call-iptables 的值为 1
echo 1 | sudo tee /proc/sys/net/bridge/bridge-nf-call-iptables
net.bridge.bridge-nf-call-iptables = 1
sudo sysctl --system
sudo yum install -y iproute-tc

配置普通用户使用 kubectl 的命令：
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config


步骤 10：安装 Pod 网络附加组件 (CNI)
Pod 之间需要网络才能通信。这里使用 Flannel。
# 应用 Flannel 的部署清单
kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml

# 等待所有 Pod 变为 Running 状态
kubectl get pods -n kube-system -w


# 查看节点状态，应为 Ready
kubectl get nodes

# 查看所有命名空间下的系统 Pod，应全部为 Running
kubectl get pods -n kube-system
